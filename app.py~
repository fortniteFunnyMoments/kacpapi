# import actual logic
import src.pixelator 

# import kivy
import kivy
from kivy.app import App
from kivy.uix.label import Label
from kivy.uix.popup import Popup
from kivy.uix.boxlayout import BoxLayout
from kivy.uix.button import Button
from kivy.uix.filechooser import FileChooserListView

class FilePickerPopup(Popup):
    def __init__(self, **kwargs):
        super(FilePickerPopup, self).__init__(**kwargs)
        self.title = 'Select a File'
        self.size_hint = (0.9, 0.9)  # Adjust the popup size

        layout = BoxLayout(orientation='vertical')
        
        # FileChooser widget to allow file selection
        self.filechooser = FileChooserListView(filters=['*.*'])  # Allow all files
        layout.add_widget(self.filechooser)

        # Buttons to confirm or cancel selection
        button_layout = BoxLayout(size_hint_y=None, height=50)

        select_button = Button(text="Select", on_press=self.select_file)
        cancel_button = Button(text="Cancel", on_press=self.dismiss)

        button_layout.add_widget(select_button)
        button_layout.add_widget(cancel_button)

        layout.add_widget(button_layout)
        self.content = layout

    def select_file(self, instance):
        selected = self.filechooser.selection
        if selected:
            # Pass the selected file path back to the main app
            self.dismiss()
            App.get_running_app().root.display_selected_file(selected[0])

class MyApp(App):
    
    def build(self):
        layout = BoxLayout(orientation='vertical', padding=10, spacing=10)
        
        self.label = Label(text="No file selected yet", size_hint_y=None, height=50)
        layout.add_widget(self.label)

        # Button to open the file picker
        file_button = Button(text="Select a File", size_hint_y=None, height=50)
        file_button.bind(on_press=self.open_file_picker)
        layout.add_widget(file_button)

        return layout

    def open_file_picker(self, instance):
        file_picker = FilePickerPopup()
        file_picker.open()

    def display_selected_file(self, file_path):
        self.label.text = f"Selected File: {file_path}"

if __name__ == '__main__':
    MyApp().run()
